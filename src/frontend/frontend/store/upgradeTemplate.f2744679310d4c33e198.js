(window.webpackJsonp=window.webpackJsonp||[]).push([["upgradeTemplate"],{"2HPp":function(t,e,s){"use strict";var a=s("8oOM");s.n(a).a},"8oOM":function(t,e,s){},LtWd:function(t,e,s){"use strict";s.r(e);var a=s("tqJc"),i=s("ehD+");for(var n in i)"default"!==n&&function(t){s.d(e,t,(function(){return i[t]}))}(n);s("2HPp");var l=s("psIG"),r=Object(l.a)(i.default,a.a,a.b,!1,null,null,null);r.options.__file="src/views/upgrade_template.vue",e.default=r.exports},XbJB:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=r(s("06Hw")),i=r(s("Kz1y")),n=r(s("YYXh")),l=r(s("/svt"));function r(t){return t&&t.__esModule?t:{default:t}}s("F7H9"),window.Vue.use(l.default),e.default={data:function(){return{showContent:!1,isOverflow:!1,isDropdownShow:!1,timer:-1,docsLink:DOCS_URL_PREFIX+"/所有服务/流水线模版/summary.html",progressStatus:[{name:"开始",step:1,status:"success"},{name:"审核中",step:2,status:"doing"},{name:"结束",step:3,status:"undo"}],loading:{isLoading:!1,title:""},templateDetail:{templateName:"",templateType:"",categoryList:"",classifyName:"",labels:[],summary:"",publisher:"",pubDescription:"",description:""}}},computed:{templateId:function(){return this.$route.params.templateId},isOver:function(){return this.progressStatus.length&&"success"===this.progressStatus[2].status}},created:function(){this.requestTplRelease(),this.requestTemplateDetail()},beforeDestroy:function(){clearTimeout(this.timer)},methods:{requestTemplateDetail:function(t){var e=this;return(0,n.default)(a.default.mark((function t(){var s,n;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading.isLoading=!0,t.prev=1,t.next=4,e.$store.dispatch("store/requestTempIdDetail",{templateId:e.templateId});case 4:s=t.sent,(0,i.default)(e.templateDetail,s),e.templateDetail.categoryList=s.categoryList.map((function(t){return t.categoryName})).join("，"),e.templateDetail.labels=s.labelList.map((function(t){return t.labelName})),e.$nextTick((function(){setTimeout((function(){e.isOverflow=e.$refs.editor&&e.$refs.editor.scrollHeight>180}),1e3)})),t.next=16;break;case 11:t.prev=11,t.t0=t.catch(1),n=t.t0.message?t.t0.message:t.t0,"error",e.$bkMessage({message:n,theme:"error"});case 16:return t.prev=16,setTimeout((function(){e.loading.isLoading=!1}),500),e.showContent=!0,t.finish(16);case 20:case"end":return t.stop()}}),t,e,[[1,11,16,20]])})))()},requestTplRelease:function(t){var e=this;return(0,n.default)(a.default.mark((function t(){var s,i;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$store.dispatch("store/requestTplRelease",{templateId:e.templateId});case 3:s=t.sent,e.progressStatus=s.processInfos,e.isOver||e.loopCheck(),t.next=13;break;case 8:t.prev=8,t.t0=t.catch(0),i=t.t0.message?t.t0.message:t.t0,"error",e.$bkMessage({message:i,theme:"error"});case 13:case"end":return t.stop()}}),t,e,[[0,8]])})))()},cancelRelease:function(){var t=this;return(0,n.default)(a.default.mark((function e(){var s,i;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=void 0,i=void 0,t.loading.isLoading=!0,e.prev=2,e.next=5,t.$store.dispatch("store/cancelReleaseTemplate",{templateId:t.templateId});case 5:s="取消成功",i="success",t.toAtomList(),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),s=e.t0.message?e.t0.message:e.t0,i="error";case 14:return e.prev=14,t.$bkMessage({message:s,theme:i}),setTimeout((function(){t.loading.isLoading=!1}),100),e.finish(14);case 18:case"end":return e.stop()}}),e,t,[[2,10,14,18]])})))()},handlerCancel:function(){var t,e=this;this.$bkInfo({title:"取消发布",subTitle:"确定取消发布该模板？",confirmFn:(t=(0,n.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.cancelRelease();case 1:case"end":return t.stop()}}),t,e)}))),function(){return t.apply(this,arguments)})})},loopCheck:function(){var t=this;return(0,n.default)(a.default.mark((function e(){var s;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=t.timer,clearTimeout(s),t.isOver||(t.timer=setTimeout((0,n.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.requestTplRelease();case 2:case"end":return e.stop()}}),e,t)}))),5e3));case 3:case"end":return e.stop()}}),e,t)})))()},toggleShow:function(){this.isDropdownShow=!this.isDropdownShow},toAtomList:function(){this.$router.push({name:"atomList",params:{type:"template"}})},toAtomStore:function(t){this.$router.push({name:"atomHome",query:t?{pipeType:"template"}:void 0})}}}},"ehD+":function(t,e,s){"use strict";s.r(e);var a=s("XbJB"),i=s.n(a);for(var n in a)"default"!==n&&function(t){s.d(e,t,(function(){return a[t]}))}(n);e.default=i.a},tqJc:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading.isLoading,title:t.loading.title},expression:"{\n        isLoading: loading.isLoading,\n        title: loading.title\n    }"}],staticClass:"upgrade-template-wrapper"},[s("h3",{staticClass:"market-home-title"},[s("icon",{staticClass:"title-icon",attrs:{name:"color-logo-store",size:"25"}}),t._v(" "),s("p",{staticClass:"title-name"},[s("span",{staticClass:"back-home",on:{click:function(e){return t.toAtomStore()}}},[t._v("研发商店")]),t._v(" "),s("i",{staticClass:"right-arrow banner-arrow"}),t._v(" "),s("span",{staticClass:"banner-des back-home",on:{click:function(e){return t.toAtomList()}}},[t._v("工作台")]),t._v(" "),s("i",{staticClass:"right-arrow banner-arrow"}),t._v(" "),s("span",{staticClass:"banner-des"},[t._v("上架模板")])]),t._v(" "),s("a",{staticClass:"title-work",attrs:{target:"_blank",href:t.docsLink}},[t._v("模板指引")])],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showContent,expression:"showContent"}],staticClass:"upgrade-template-content"},[s("div",{staticClass:"template-release-msg"},[s("div",{staticClass:"detail-title release-progress-title"},[s("p",{staticClass:"form-title"},[t._v("发布进度\n                    "),t.isOver?t._e():s("span",{staticClass:"cancel-release-btn",on:{click:function(e){return t.handlerCancel()}}},[t._v("取消发布")])]),t._v(" "),s("hr",{staticClass:"cut-line"}),t._v(" "),s("div",{staticClass:"progress-step"},[s("div",{staticClass:"step-line-box"},t._l(t.progressStatus,(function(e,a){return s("div",{key:a,staticClass:"step-card",class:{"processing-status":"doing"===e.status,"success-status":"结束"===e.name&&"success"===e.status,"fail-status":"fail"===e.status}},[s("div",{staticClass:"card-item"},["success"===e.status?s("i",{staticClass:"bk-icon icon-check-1"}):t._e(),t._v(" "),s("p",{staticClass:"step-label"},[t._v(t._s(e.name))])]),t._v(" "),"审核中"===e.name&&"doing"===e.status?s("div",{staticClass:"audit-tips"},[s("i",{staticClass:"bk-icon icon-info-circle"}),t._v("由蓝盾管理员审核\n                            ")]):t._e()])})),0)])]),t._v(" "),t.isOver?t._e():s("div",{staticClass:"detail-title version-detail-title"},[s("p",{staticClass:"form-title"},[t._v("版本详情")]),t._v(" "),s("hr",{staticClass:"cut-line"}),t._v(" "),s("div",{staticClass:"template-version-detail"},[s("div",{staticClass:"detail-form-item multi-item"},[s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[t._v("名称：")]),t._v(" "),s("div",{staticClass:"info-value"},[t._v(t._s(t.templateDetail.templateName))])]),t._v(" "),s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[t._v("分类：")]),t._v(" "),s("div",{staticClass:"info-value"},[t._v(t._s(t.templateDetail.classifyName))])])]),t._v(" "),s("div",{staticClass:"detail-form-item multi-item"},[s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[t._v("应用范畴：")]),t._v(" "),s("div",{staticClass:"info-value"},[t._v(t._s(t.templateDetail.categoryList))])])]),t._v(" "),s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[t._v("功能标签：")]),t._v(" "),s("div",{staticClass:"info-value feature-label"},t._l(t.templateDetail.labels,(function(e,a){return s("div",{key:a,staticClass:"label-card"},[t._v(t._s(e))])})),0)]),t._v(" "),s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[t._v("简介：")]),t._v(" "),s("div",{staticClass:"info-value"},[t._v(t._s(t.templateDetail.summary))])]),t._v(" "),s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[t._v("详细描述：")]),t._v(" "),s("div",{ref:"editor",staticClass:"info-value markdown-editor-show",class:{overflow:!t.isDropdownShow}},[s("mavon-editor",{attrs:{editable:!1,"default-open":"preview",subfield:!1,"toolbars-flag":!1,"external-link":!1,"box-shadow":!1},model:{value:t.templateDetail.description,callback:function(e){t.$set(t.templateDetail,"description",e)},expression:"templateDetail.description"}})],1)]),t._v(" "),t.isOverflow?s("div",{staticClass:"toggle-btn",on:{click:function(e){return t.toggleShow()}}},[t._v(t._s(t.isDropdownShow?"收起":"展开")+"\n                        "),s("i",{class:["bk-icon icon-angle-down",{"icon-flip":t.isDropdownShow}]})]):t._e(),t._v(" "),s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[t._v("发布者：")]),t._v(" "),s("div",{staticClass:"info-value"},[t._v(t._s(t.templateDetail.publisher))])]),t._v(" "),s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[t._v("发布描述：")]),t._v(" "),s("div",{staticClass:"info-value"},[t._v(t._s(t.templateDetail.pubDescription))])])]),t._v(" "),s("div",{staticClass:"template-logo-box"},[t.templateDetail.logoUrl?s("img",{attrs:{src:t.templateDetail.logoUrl}}):s("i",{staticClass:"bk-icon icon-placeholder template-logo"})])]),t._v(" "),t.isOver?s("div",{staticClass:"released-tips"},[s("h3",[t._v("恭喜，成功发布到商店!")]),t._v(" "),s("div",{staticClass:"handle-btn"},[s("bk-button",{staticClass:"bk-button bk-primary",attrs:{size:"small"},on:{click:function(e){return t.toAtomList()}}},[t._v("工作台")]),t._v(" "),s("bk-button",{staticClass:"bk-button bk-default",attrs:{size:"small"},on:{click:function(e){return t.toAtomStore(1)}}},[t._v("研发商店")])],1)]):t._e()])])])},i=[];a._withStripped=!0,s.d(e,"a",(function(){return a})),s.d(e,"b",(function(){return i}))}}]);