(window.webpackJsonp=window.webpackJsonp||[]).push([["installAtom"],{M1rL:function(t,e,s){"use strict";s.r(e);var a=s("vw6m"),r=s.n(a);for(var o in a)"default"!==o&&function(t){s.d(e,t,(function(){return a[t]}))}(o);e.default=r.a},XG2H:function(t,e,s){"use strict";s.r(e);var a=s("sfNd"),r=s("M1rL");for(var o in r)"default"!==o&&function(t){s.d(e,t,(function(){return r[t]}))}(o);s("oaqr");var n=s("psIG"),i=Object(n.a)(r.default,a.a,a.b,!1,null,null,null);i.options.__file="src/views/install_atom.vue",e.default=i.exports},oaqr:function(t,e,s){"use strict";var a=s("wVv/");s.n(a).a},sfNd:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading.isLoading,title:t.loading.title},expression:"{\n        isLoading: loading.isLoading,\n        title: loading.title\n    }"}],staticClass:"install-atom-wrapper"},[s("h3",{staticClass:"market-home-title"},[s("icon",{staticClass:"title-icon",attrs:{name:"color-logo-store",size:"25"}}),t._v(" "),s("p",{staticClass:"title-name"},[s("router-link",{staticClass:"back-home",attrs:{to:{name:"atomHome"}}},[t._v("研发商店")]),t._v(" "),s("i",{staticClass:"right-arrow banner-arrow"}),t._v(" "),s("span",{staticClass:"back-home",on:{click:t.backToStore}},[t._v(t._s(t._f("isInstallAtomFilter")(t.isInstallAtom)))]),t._v(" "),s("i",{staticClass:"right-arrow banner-arrow"}),t._v(" "),s("span",{staticClass:"banner-des back-home",on:{click:t.toBack}},[t._v(t._s(t.secondaryTitle))]),t._v(" "),s("i",{staticClass:"right-arrow banner-arrow"}),t._v(" "),t.isInstallAtom?s("span",[t._v("安装流水线插件")]):s("span",[t._v("安装模板")])],1)],1),t._v(" "),t.showContent?s("div",{staticClass:"install-atom-content"},[t.isINstallSuccess?s("div",{staticClass:"install-success-tips"},[s("i",{staticClass:"bk-icon icon-check-circle"}),t._v(" "),s("h3",[t._v("恭喜，已安装成功！")]),t._v(" "),s("div",{staticClass:"handle-btn"},[s("bk-button",{staticClass:"bk-button bk-primary",attrs:{size:"small"},on:{click:function(e){return t.backConsole()}}},[t._v("工作台")]),t._v(" "),s("bk-button",{staticClass:"bk-button bk-default",attrs:{size:"small"},on:{click:function(e){return t.backToStore()}}},[t._v("研发商店")]),t._v(" "),s("bk-button",{staticClass:"bk-button bk-default",attrs:{size:"small"},on:{click:function(e){return t.toPipeline()}}},[t._v("流水线")])],1)]):s("div",{staticClass:"sub-view-port"},[s("div",{staticClass:"atom-name"},[t._v(t._s(t.formName))]),t._v(" "),s("div",{staticClass:"title"},[t._v("请选择项目：")]),t._v(" "),s("bk-select",{attrs:{searchable:"",multiple:"","show-select-all":""},model:{value:t.project,callback:function(e){t.project=e},expression:"project"}},[t._l(t.projectList,(function(e,a){return s("bk-option",{key:a,attrs:{id:e.project_code,name:e.project_name,placeholder:"请选择"},on:{toggle:t.getProjectList,selected:t.selectProject},nativeOn:{click:function(e){return t.selectedProject(e)}}})})),t._v(" "),s("div",{staticStyle:{cursor:"pointer"},attrs:{slot:"extension"},slot:"extension"},[s("a",{attrs:{href:t.itemUrl,target:"_blank"}},[s("i",{staticClass:"bk-icon icon-plus-circle"}),t._v("\n                        "+t._s(t.itemText)+"\n                    ")])])],2),t._v(" "),t.installError?s("div",{staticClass:"error-tips"},[t._v("项目不能为空")]):t._e(),t._v(" "),s("div",{staticClass:"form-footer"},[s("button",{staticClass:"bk-button bk-primary",attrs:{type:"button",disabled:!t.isAgree},on:{click:function(e){return t.confirm()}}},[t._v("安装")]),t._v(" "),s("button",{staticClass:"bk-button bk-default",attrs:{type:"button"},on:{click:function(e){return t.toBack()}}},[t._v("取消")])]),t._v(" "),t.installedProject.length?s("section",[s("p",{staticClass:"project-title"},[t._v("该"+t._s(t.isInstallAtom?"流水线插件":"模板")+"已安装至以下项目：")]),t._v(" "),s("table",{staticClass:"bk-table project-table"},[s("thead"),t._v(" "),s("tbody",t._l(t.installedProject,(function(e,a){return s("tr",{key:a},[s("td",[t._v(t._s(e.projectName))])])})),0)])]):t._e()],1)]):t._e()])},r=[];a._withStripped=!0,s.d(e,"a",(function(){return a})),s.d(e,"b",(function(){return r}))},vw6m:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(s("06Hw")),r=i(s("YYXh")),o=i(s("Kz1y")),n=s("WIBD");function i(t){return t&&t.__esModule?t:{default:t}}e.default={filters:{isInstallAtomFilter:function(t){return t?"流水线插件":"流水线模板"}},data:function(){return{itemUrl:"/console/pm",itemText:"新建项目",showContent:!1,installError:!1,isINstallSuccess:!1,isAgree:!0,atomId:"",templateId:"",project:[],projectList:window.projectList,installedProject:[],formName:"",loading:{isLoading:!1,title:""}}},computed:(0,o.default)({},(0,n.mapGetters)("store",{markerQuey:"getMarketQuery"}),{routerParams:function(){return this.$route.params},atomCode:function(){return this.routerParams.atomCode},templateCode:function(){return this.routerParams.templateCode},originType:function(){return"#MYATOM"===this.$route.hash?"myAtom":"storeAtom"},isInstallAtom:function(){return"installAtom"===this.$route.name},secondaryTitle:function(){return"myAtom"===this.originType?"工作台":this.formName}}),created:function(){var t=this;return(0,r.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.requestAtomDetail();case 2:return e.next=4,t.requestRelativeProject();case 4:t.$route.query.projectCode&&t.project.push(t.$route.query.projectCode);case 5:case"end":return e.stop()}}),e,t)})))()},methods:{requestAtomDetail:function(){var t=this;return(0,r.default)(a.default.mark((function e(){var s,r;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.loading.isLoading=!0,e.prev=1,s={},!t.isInstallAtom){e.next=9;break}return e.next=6,t.$store.dispatch("store/requestAtom",{atomCode:t.atomCode});case 6:s=e.sent,e.next=12;break;case 9:return e.next=11,t.$store.dispatch("store/requestTemplate",{templateCode:t.templateCode});case 11:s=e.sent;case 12:t.formName=t.isInstallAtom?s.name:s.templateName,t.isInstallAtom?t.atomId=s.atomId:t.templateId=s.templateId,e.next=21;break;case 16:e.prev=16,e.t0=e.catch(1),r=e.t0.message?e.t0.message:e.t0,"error",t.$bkMessage({message:r,theme:"error"});case 21:return e.prev=21,setTimeout((function(){t.loading.isLoading=!1,t.showContent=!0}),100),e.finish(21);case 24:case"end":return e.stop()}}),e,t,[[1,16,21,24]])})))()},requestRelativeProject:function(){var t=this;return(0,r.default)(a.default.mark((function e(){var s,r;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.loading.isLoading=!0,e.prev=1,s=void 0,!t.isInstallAtom){e.next=9;break}return e.next=6,t.$store.dispatch("store/requestRelativeProject",{atomCode:t.atomCode});case 6:s=e.sent,e.next=12;break;case 9:return e.next=11,t.$store.dispatch("store/requestRelativeTplProject",{templateCode:t.templateCode});case 11:s=e.sent;case 12:s.map((function(e){t.installedProject.push(e),t.projectList=t.projectList.filter((function(t){return t.project_code!==e.projectCode}))})),e.next=20;break;case 15:e.prev=15,e.t0=e.catch(1),r=e.t0.message?e.t0.message:e.t0,"error",t.$bkMessage({message:r,theme:"error"});case 20:return e.prev=20,setTimeout((function(){t.loading.isLoading=!1}),1e3),e.finish(20);case 23:case"end":return e.stop()}}),e,t,[[1,15,20,23]])})))()},toBack:function(){"myAtom"===this.originType?this.backConsole():this.$router.push({name:"details",params:{code:this.isInstallAtom?this.atomCode:this.templateCode,type:this.isInstallAtom?"atom":"template"}})},backConsole:function(){this.$router.push({name:"atomList",params:{type:this.isInstallAtom?"atom":"template"}})},backToStore:function(){var t=this.isInstallAtom?"atom":"template";(0,o.default)(this.markerQuey,{pipeType:t}),this.$router.push({name:"atomHome",query:this.markerQuey})},toLink:function(){window.open(DOCS_URL_PREFIX+"/","_target")},toPipeline:function(){window.open("/console/pipeline","_self")},getProjectList:function(){},selectProject:function(t){this.project=t,this.installError=!1},confirm:function(){var t=this;return(0,r.default)(a.default.mark((function e(){var s,r,o,n,i,c;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.project.length){e.next=4;break}t.installError=!0,e.next=28;break;case 4:if(s=void 0,r=void 0,o=void 0,n={},t.isInstallAtom?(n.atomCode=t.atomCode,n.projectCode=t.project):(n.templateCode=t.templateCode,n.projectCodeList=t.project),t.loading.isLoading=!0,e.prev=8,!t.isInstallAtom){e.next=15;break}return e.next=12,t.$store.dispatch("store/installAtom",{params:n});case 12:o=e.sent,e.next=18;break;case 15:return e.next=17,t.$store.dispatch("store/installTemplate",{params:n});case 17:o=e.sent;case 18:o&&(s="安装成功",r="success"),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(8),200===e.t0.httpStatus?(i=t.$createElement,c=i("p",{style:{textAlign:"left",padding:"20px 30px 0"}},e.t0.message?e.t0.message:e.t0),t.$bkInfo({type:"error",clsName:"error-commit",delay:1e4,statusOpts:{title:"安装失败",subtitle:c}})):(s=e.t0.message?e.t0.message:e.t0,r="error");case 24:return e.prev=24,t.loading.isLoading=!1,"success"===r?t.isINstallSuccess=!0:"error"===r&&t.$bkMessage({message:s,theme:r}),e.finish(24);case 28:case"end":return e.stop()}}),e,t,[[8,21,24,28]])})))()}}}},"wVv/":function(t,e,s){}}]);