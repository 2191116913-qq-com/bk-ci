(window.webpackJsonp=window.webpackJsonp||[]).push([["releaseProgress"],{"3vJe":function(e,t,s){"use strict";
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */t.parse=function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");for(var s={},i=t||{},o=e.split(r),l=i.decode||a,c=0;c<o.length;c++){var u=o[c],v=u.indexOf("=");if(!(v<0)){var d=u.substr(0,v).trim(),f=u.substr(++v,u.length).trim();'"'==f[0]&&(f=f.slice(1,-1)),null==s[d]&&(s[d]=n(f,l))}}return s},t.serialize=function(e,t,s){var a=s||{},r=a.encode||i;if("function"!=typeof r)throw new TypeError("option encode is invalid");if(!o.test(e))throw new TypeError("argument name is invalid");var n=r(t);if(n&&!o.test(n))throw new TypeError("argument val is invalid");var l=e+"="+n;if(null!=a.maxAge){var c=a.maxAge-0;if(isNaN(c))throw new Error("maxAge should be a Number");l+="; Max-Age="+Math.floor(c)}if(a.domain){if(!o.test(a.domain))throw new TypeError("option domain is invalid");l+="; Domain="+a.domain}if(a.path){if(!o.test(a.path))throw new TypeError("option path is invalid");l+="; Path="+a.path}if(a.expires){if("function"!=typeof a.expires.toUTCString)throw new TypeError("option expires is invalid");l+="; Expires="+a.expires.toUTCString()}a.httpOnly&&(l+="; HttpOnly");a.secure&&(l+="; Secure");if(a.sameSite){switch("string"==typeof a.sameSite?a.sameSite.toLowerCase():a.sameSite){case!0:l+="; SameSite=Strict";break;case"lax":l+="; SameSite=Lax";break;case"strict":l+="; SameSite=Strict";break;default:throw new TypeError("option sameSite is invalid")}}return l};var a=decodeURIComponent,i=encodeURIComponent,r=/; */,o=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function n(e,t){try{return t(e)}catch(t){return e}}},"7BPt":function(e,t,s){"use strict";var a=s("hKg0");s.n(a).a},KwTm:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading.isLoading,title:e.loading.title},expression:"{\n        isLoading: loading.isLoading,\n        title: loading.title\n    }"}],staticClass:"release-progress-wrapper"},[s("div",{staticClass:"info-header"},[s("div",{staticClass:"sub_header_left"},[s("div",{staticClass:"title first-level",on:{click:function(t){return e.toAtomStore()}}},[s("logo",{staticClass:"nav-icon",attrs:{name:"store",size:"30"}}),e._v(" "),s("div",{staticClass:"title first-level"},[e._v("研发商店")])],1),e._v(" "),s("i",{staticClass:"right-arrow"}),e._v(" "),s("div",{staticClass:"title secondary",on:{click:function(t){return e.toAtomList()}}},[e._v("工作台")]),e._v(" "),s("i",{staticClass:"right-arrow"}),e._v(" "),s("div",{staticClass:"title third-level"},[s("span",{},[e._v(e._s(e.curTitle))]),e._v(" "),s("span",[e._v("（"+e._s(e.versionDetail.atomCode)+"）")])])]),e._v(" "),s("div",{staticClass:"sub_header_right"},[s("a",{staticClass:"develop-guide-link",attrs:{target:"_blank",href:e.docsLink}},[e._v("插件指引")])])]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.showContent,expression:"showContent"}],staticClass:"release-progress-content"},[s("div",{staticClass:"atom-release-msg"},[s("div",{staticClass:"detail-title release-progress-title"},[s("p",{staticClass:"form-title"},[e._v("发布进度\n                    "),e.isOver?e._e():s("span",{staticClass:"cancel-release-btn",on:{click:function(t){return e.handlerCancel()}}},[e._v("取消发布")])]),e._v(" "),s("hr",{staticClass:"cut-line"}),e._v(" "),s("div",{staticClass:"progress-step"},[s("div",{staticClass:"step-line-box"},e._l(e.progressStatus,(function(t,a){return s("div",{key:a,staticClass:"step-card",class:{"processing-status":"doing"===t.status,"fail-status":"fail"===t.status,"success-status":"结束"===t.name&&"success"===t.status}},[s("div",{staticClass:"card-item"},["success"===t.status?s("i",{staticClass:"bk-icon icon-check-1"}):e._e(),e._v(" "),s("p",{staticClass:"step-label"},[e._v(e._s(t.name))])]),e._v(" "),s("div",{staticClass:"retry-bth"},["提交"===t.name&&["doing","success"].includes(t.status)&&!e.isOver?s("span",{staticClass:"test-btn"},[s("span",[e._v("重新传包")]),e._v(" "),s("input",{staticClass:"upload-input",attrs:{type:"file",title:"",accept:"application/zip"},on:{change:e.selectFile}})]):e._e()]),e._v(" "),s("div",{staticClass:"retry-bth"},["测试中"===t.name&&"doing"===t.status?s("span",{staticClass:"test-btn"},[s("a",{attrs:{target:"_blank",href:"/console/pipeline/"+e.versionDetail.projectCode+"/list"}},[e._v("测试")])]):e._e()]),e._v(" "),"测试中"===t.name||"测试"===t.name?s("bk-button",{staticClass:"pass-btn",attrs:{theme:"primary",size:"small",disabled:"doing"!==t.status},on:{click:function(t){return t.stopPropagation(),e.passTest()}}},[e._v("继续")]):e._e()],1)})),0)])]),e._v(" "),e.isOver?e._e():s("div",{staticClass:"detail-title version-detail-title"},[s("p",{staticClass:"form-title"},[e._v("版本详情")]),e._v(" "),s("hr",{staticClass:"cut-line"}),e._v(" "),s("div",{staticClass:"atom-version-detail"},[s("div",{staticClass:"detail-form-item multi-item"},[s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[e._v("名称：")]),e._v(" "),s("div",{staticClass:"info-value"},[e._v(e._s(e.versionDetail.name))])]),e._v(" "),s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[e._v("标识：")]),e._v(" "),s("div",{staticClass:"info-value"},[e._v(e._s(e.versionDetail.atomCode))])])]),e._v(" "),s("div",{staticClass:"detail-form-item multi-item"},[s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[e._v("范畴：")]),e._v(" "),s("div",{staticClass:"info-value"},[e._v(e._s(e.categoryMap[e.versionDetail.category]))])]),e._v(" "),s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[e._v("分类：")]),e._v(" "),s("div",{staticClass:"info-value"},[e._v(e._s(e.versionDetail.classifyName))])])]),e._v(" "),s("div",{staticClass:"detail-form-item multi-item"},[s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[e._v("操作系统：")]),e._v(" "),e.versionDetail.os?s("div",{staticClass:"info-value"},["AGENT"===e.versionDetail.jobType?s("span",[-1!==e.versionDetail.os.indexOf("LINUX")?s("i",{staticClass:"bk-icon icon-linux-view"}):e._e(),e._v(" "),-1!==e.versionDetail.os.indexOf("WINDOWS")?s("i",{staticClass:"bk-icon icon-windows"}):e._e(),e._v(" "),-1!==e.versionDetail.os.indexOf("MACOS")?s("i",{staticClass:"bk-icon icon-macos"}):e._e()]):e._e()]):e._e()])]),e._v(" "),s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[e._v("功能标签：")]),e._v(" "),s("div",{staticClass:"info-value feature-label"},e._l(e.versionDetail.labels,(function(t,a){return s("div",{key:a,staticClass:"label-card"},[e._v(e._s(t))])})),0)]),e._v(" "),s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[e._v("简介：")]),e._v(" "),s("div",{staticClass:"info-value"},[e._v(e._s(e.versionDetail.summary))])]),e._v(" "),s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[e._v("详细描述：")]),e._v(" "),s("div",{ref:"editor",staticClass:"info-value markdown-editor-show",class:{overflow:!e.isDropdownShow}},[s("mavon-editor",{attrs:{editable:!1,"default-open":"preview",subfield:!1,"toolbars-flag":!1,"external-link":!1,"box-shadow":!1},model:{value:e.versionDetail.description,callback:function(t){e.$set(e.versionDetail,"description",t)},expression:"versionDetail.description"}})],1)]),e._v(" "),e.isOverflow?s("div",{staticClass:"toggle-btn",on:{click:function(t){return e.toggleShow()}}},[e._v(e._s(e.isDropdownShow?"收起":"展开")+"\n                        "),s("i",{class:["bk-icon icon-angle-down",{"icon-flip":e.isDropdownShow}]})]):e._e(),e._v(" "),s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[e._v("发布者：")]),e._v(" "),s("div",{staticClass:"info-value"},[e._v(e._s(e.versionDetail.publisher))])]),e._v(" "),s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[e._v("发布类型：")]),e._v(" "),s("div",{staticClass:"info-value"},[e._v(e._s(e.releaseMap[e.versionDetail.releaseType]))])]),e._v(" "),s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[e._v("版本：")]),e._v(" "),s("div",{staticClass:"info-value"},[e._v(e._s(e.versionDetail.version))])]),e._v(" "),s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[e._v("发布包：")]),e._v(" "),s("div",{staticClass:"info-value"},[e._v(e._s(e.versionDetail.pkgName))])]),e._v(" "),s("div",{staticClass:"detail-form-item"},[s("div",{staticClass:"info-label"},[e._v("发布描述：")]),e._v(" "),s("div",{staticClass:"info-value"},[e._v(e._s(e.versionDetail.versionContent))])])]),e._v(" "),s("div",{staticClass:"atom-logo-box"},[e.versionDetail.logoUrl?s("img",{attrs:{src:e.versionDetail.logoUrl}}):s("i",{staticClass:"bk-icon icon-placeholder atom-logo"})])]),e._v(" "),e.isOver?s("div",{staticClass:"released-tips"},[s("h3",[e._v("恭喜，成功发布到商店!")]),e._v(" "),s("div",{staticClass:"handle-btn"},[s("bk-button",{staticClass:"bk-button bk-primary",attrs:{size:"small"},on:{click:function(t){return e.toAtomList()}}},[e._v("工作台")]),e._v(" "),s("bk-button",{staticClass:"bk-button bk-default",attrs:{size:"small"},on:{click:function(t){return e.toAtomStore()}}},[e._v("研发商店")])],1)]):e._e()])])])},i=[];a._withStripped=!0,s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return i}))},"UR6/":function(e,t,s){s("k/kI"),s("WwSA"),e.exports=s("uMC/")},Z9Ou:function(e,t,s){"use strict";s.r(t);var a=s("ryfV"),i=s.n(a);for(var r in a)"default"!==r&&function(e){s.d(t,e,(function(){return a[e]}))}(r);t.default=i.a},hKg0:function(e,t,s){},ryfV:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=c(s("t3kO")),i=c(s("Kz1y")),r=c(s("06Hw")),o=c(s("YYXh")),n=c(s("3vJe")),l=c(s("/svt"));function c(e){return e&&e.__esModule?e:{default:e}}s("F7H9");var u=window.Vue,v=n.default.parse(document.cookie).backend_csrftoken;u.use(l.default),t.default={filters:{levelFilter:function(e){return"LOGIN_PUBLIC"===e?"是":"否"}},data:function(){return{atomlogoUrl:"",currentProjectId:"",currentBuildNo:"",currentPipelineId:"",docsLink:DOCS_URL_PREFIX+"/所有服务/流水线插件Store/快速入门.html",timer:-1,showContent:!1,isOverflow:!1,isDropdownShow:!1,progressStatus:[],atomBuildInfo:{},loading:{isLoading:!1,title:""},categoryMap:{TASK:"流水线插件",TRIGGER:"流水线触发器"},jobTypeMap:{AGENT:"编译环境",AGENT_LESS:"无编译环境"},osMap:{LINUX:"Linux",WINDOWS:"Windows",MACOS:"macOS"},releaseMap:{NEW:"新上架",INCOMPATIBILITY_UPGRADE:"非兼容式升级",COMPATIBILITY_UPGRADE:"兼容式功能更新",COMPATIBILITY_FIX:"兼容式问题修正"},versionDetail:{description:"",visibilityLevel:""}}},computed:{routerParams:function(){return this.$route.params},curTitle:function(){return"shelf"===this.routerParams.releaseType?"上架插件":"升级插件"},isOver:function(){return this.progressStatus.length&&"success"===this.progressStatus[3].status},postUrl:function(){return GW_URL_PREFIX+"/artifactory/api/user/artifactories/projects/"+this.versionDetail.projectCode+"/ids/"+this.versionDetail.atomId+"/codes/"+this.versionDetail.atomCode+"/versions/"+this.versionDetail.version+"/re/archive"}},created:function(){var e=this;return(0,o.default)(r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.requestRelease(e.routerParams.atomId);case 2:return t.next=4,e.requestAtomDetail(e.routerParams.atomId);case 4:case"end":return t.stop()}}),t,e)})))()},beforeDestroy:function(){clearTimeout(this.timer)},methods:{toAtomList:function(){this.$router.push({name:"atomList",params:{type:"atom"}})},toAtomStore:function(){this.$router.push({name:"atomHome"})},requestAtomDetail:function(e){var t=this;return(0,o.default)(r.default.mark((function s(){var a,o;return r.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return t.loading.isLoading=!0,s.prev=1,s.next=4,t.$store.dispatch("store/requestAtomDetail",{atomId:e});case 4:a=s.sent,(0,i.default)(t.versionDetail,a),t.versionDetail.labels=a.labelList.map((function(e){return e.labelName})),t.$nextTick((function(){setTimeout((function(){t.isOverflow=t.$refs.editor&&t.$refs.editor.scrollHeight>180}),1e3)})),s.next=15;break;case 10:s.prev=10,s.t0=s.catch(1),o=s.t0.message?s.t0.message:s.t0,"error",t.$bkMessage({message:o,theme:"error"});case 15:return s.prev=15,setTimeout((function(){t.loading.isLoading=!1}),500),t.showContent=!0,s.finish(15);case 19:case"end":return s.stop()}}),s,t,[[1,10,15,19]])})))()},requestRelease:function(e){var t=this;return(0,o.default)(r.default.mark((function s(){var a,i;return r.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,t.$store.dispatch("store/requestRelease",{atomId:e});case 3:a=s.sent,t.progressStatus=a.processInfos,a.atomBuildInfo&&(t.atomBuildInfo=a.atomBuildInfo),t.isOver||t.loopCheck(),s.next=14;break;case 9:s.prev=9,s.t0=s.catch(0),i=s.t0.message?s.t0.message:s.t0,"error",t.$bkMessage({message:i,theme:"error"});case 14:case"end":return s.stop()}}),s,t,[[0,9]])})))()},passTest:function(){var e=this;return(0,o.default)(r.default.mark((function t(){var s,a;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=void 0,a=void 0,t.prev=1,t.next=4,e.$store.dispatch("store/passTest",{atomId:e.routerParams.atomId});case 4:s="操作成功",a="success",e.requestRelease(e.routerParams.atomId),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(1),s=t.t0.message?t.t0.message:t.t0,a="error";case 13:return t.prev=13,e.$bkMessage({message:s,theme:a}),t.finish(13);case 16:case"end":return t.stop()}}),t,e,[[1,9,13,16]])})))()},loopCheck:function(){var e=this;return(0,o.default)(r.default.mark((function t(){var s;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s=e.timer,clearTimeout(s),e.isOver||(e.timer=setTimeout((0,o.default)(r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.requestRelease(e.routerParams.atomId);case 2:case"end":return t.stop()}}),t,e)}))),5e3));case 3:case"end":return t.stop()}}),t,e)})))()},handlerCancel:function(){var e,t=this,s=(0,this.$createElement)("p",{style:{textAlign:"center"}},"确定取消发布该插件？");this.$bkInfo({title:"取消发布",subHeader:s,maskClose:!0,confirmFn:(e=(0,o.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.cancelRelease();case 1:case"end":return e.stop()}}),e,t)}))),function(){return e.apply(this,arguments)})})},cancelRelease:function(){var e=this;return(0,o.default)(r.default.mark((function t(){var s,a;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=void 0,a=void 0,e.loading.isLoading=!0,t.prev=2,t.next=5,e.$store.dispatch("store/cancelRelease",{atomId:e.routerParams.atomId});case 5:s="取消成功",a="success",e.toAtomList(),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(2),s=t.t0.message?t.t0.message:t.t0,a="error";case 14:return t.prev=14,e.$bkMessage({message:s,theme:a}),setTimeout((function(){e.loading.isLoading=!1}),1e3),t.finish(14);case 18:case"end":return t.stop()}}),t,e,[[2,10,14,18]])})))()},selectFile:function(){var e=event.target.files;if(e.length){var t=!0,s=!1,i=void 0;try{for(var r,o=(0,a.default)(e);!(t=(r=o.next()).done);t=!0){var n=r.value,l={name:n.name,size:n.size/1e3/1e3,type:n.type,origin:n};"application/x-zip-compressed"!==l.type?this.$bkMessage({message:"只允许上传 zip 格式的文件",theme:"error"}):this.uploadFile(l)}}catch(e){s=!0,i=e}finally{try{!t&&o.return&&o.return()}finally{if(s)throw i}}}},uploadFile:function(e){var t=this,s=new FormData;s.append("file",e.origin),s.append("os",'["'+this.versionDetail.os.join('","')+'"]');var a=new XMLHttpRequest;e.xhr=a,a.withCredentials=!0,a.open("POST",this.postUrl,!0),a.onreadystatechange=function(){if(4===a.readyState){var e=void 0,s=void 0;if(200===a.status){var i=JSON.parse(a.responseText);0===i.status?(e="success",s="上传成功",t.requestRelease(t.routerParams.atomId),t.requestAtomDetail(t.routerParams.atomId)):(e="error",s=i.message)}else{e="error",s=JSON.parse(a.responseText).message}t.$bkMessage({message:s,theme:e})}},a.upload&&(a.upload.onprogress=function(e){if(e.lengthComputable){var s=Math.floor(e.loaded/e.total*100);t.progress=s>=1?s-1:0}}),a.setRequestHeader("X-CSRFToken",v),a.send(s),document.querySelector(".upload-input").value=""},atomOs:function(e){var t=this,s=[];return e.forEach((function(e){s.push(t.osMap[e])})),s.join("，")},toggleShow:function(){this.isDropdownShow=!this.isDropdownShow}}}},t3kO:function(e,t,s){e.exports={default:s("UR6/"),__esModule:!0}},"uMC/":function(e,t,s){var a=s("ADe/"),i=s("VJcA");e.exports=s("TaGV").getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return a(t.call(e))}},z65S:function(e,t,s){"use strict";s.r(t);var a=s("KwTm"),i=s("Z9Ou");for(var r in i)"default"!==r&&function(e){s.d(t,e,(function(){return i[e]}))}(r);s("7BPt");var o=s("psIG"),n=Object(o.a)(i.default,a.a,a.b,!1,null,null,null);n.options.__file="src/views/release_progress.vue",t.default=n.exports}}]);