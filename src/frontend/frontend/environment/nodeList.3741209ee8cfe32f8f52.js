(window.webpackJsonp=window.webpackJsonp||[]).push([["nodeList"],{"5xk0":function(t,e,n){"use strict";n.r(e);var s=n("l/j9"),o=n.n(s);for(var a in s)"default"!==a&&function(t){n.d(e,t,(function(){return s[t]}))}(a);e.default=o.a},"80kE":function(t,e,n){"use strict";n.r(e);var s=n("Te0k"),o=n.n(s);for(var a in s)"default"!==a&&function(t){n.d(e,t,(function(){return s[t]}))}(a);e.default=o.a},GXF3:function(t,e){t.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIyLjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiCgkgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTAyNCAxMDI0OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2Rpc3BsYXk6bm9uZTt9Cgkuc3Qxe2ZpbGw6IzczNzk4Nzt9Cgkuc3Qye2ZpbGw6IzdBODE5Mzt9Cjwvc3R5bGU+CjxnIGlkPSLlm77lsYJfNiIgY2xhc3M9InN0MCI+CjwvZz4KPGcgaWQ9IuWPjemmiCI+CjwvZz4KPGcgaWQ9IuWbvuWxgl8yIj4KPC9nPgo8ZyBpZD0i5Zu+5bGCXzMiPgo8L2c+CjxnIGlkPSLlm77lsYJfNCI+CjwvZz4KPGcgaWQ9IuWbvuWxgl81Ij4KPC9nPgo8ZyBpZD0i5LiK5LygIj4KPC9nPgo8ZyBpZD0i5Zu+5bGCXzgiPgo8L2c+CjxnIGlkPSLlm77lsYJfOSI+CjwvZz4KPGcgaWQ9IuWbvuWxgl8xMCI+CjwvZz4KPGcgaWQ9IuWbvuWxgl8xMSI+CjwvZz4KPGcgaWQ9IuWbvuWxgl8xMiI+Cgk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNODY1LDk2MEgxNjFjLTE3LjcsMC0zMi0xNC4zLTMyLTMyVjk2YzAtMTcuNywxNC4zLTMyLDMyLTMyaDcwNGMxNy43LDAsMzIsMTQuMywzMiwzMnY4MzIKCQlDODk3LDk0NS43LDg4Mi43LDk2MCw4NjUsOTYweiIvPgoJPHBhdGggY2xhc3M9InN0MiIgZD0iTTgzMiwxMjh2NzY3SDE5MlYxMjhIODMyIE04NjQsNjRIMTYwYy0xNy43LDAtMzIsMTQuMy0zMiwzMnY4MzFjMCwxNy43LDE0LjMsMzIsMzIsMzJoNzA0CgkJYzE3LjcsMCwzMi0xNC4zLDMyLTMyVjk2Qzg5Niw3OC4zLDg4MS43LDY0LDg2NCw2NEw4NjQsNjR6Ii8+Cgk8Zz4KCQk8cmVjdCB4PSIyNzIiIHk9IjIxMy44IiBjbGFzcz0ic3QyIiB3aWR0aD0iNDgwIiBoZWlnaHQ9IjE0OCIvPgoJPC9nPgoJPGc+CgkJPHJlY3QgeD0iMjcyIiB5PSI0MTIuOSIgY2xhc3M9InN0MiIgd2lkdGg9IjQ4MCIgaGVpZ2h0PSI0OCIvPgoJPC9nPgoJPGc+CgkJPHJlY3QgeD0iMjcyIiB5PSI1MTIuNCIgY2xhc3M9InN0MiIgd2lkdGg9IjQ4MCIgaGVpZ2h0PSI0OCIvPgoJPC9nPgoJPGc+CgkJPGNpcmNsZSBjbGFzcz0ic3QyIiBjeD0iNTEyIiBjeT0iNzYwLjEiIHI9IjQ4Ii8+Cgk8L2c+Cgk8Zz4KCQk8Y2lyY2xlIGNsYXNzPSJzdDIiIGN4PSI1MTIiIGN5PSI2MzUuOCIgcj0iMjQiLz4KCTwvZz4KPC9nPgo8L3N2Zz4K"},Ixaf:function(t,e,n){},"K3Q+":function(t,e,n){},MkV0:function(t,e,n){"use strict";var s=n("Ixaf");n.n(s).a},MlCl:function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"node-list-wrapper"},[n("div",{staticClass:"node-header"},[n("div",{staticClass:"title"},[t._v("节点")]),t._v(" "),t.nodeList.length>0?n("div",{staticClass:"header-handler-row"},[n("bk-button",{staticClass:"import-vmbuild-btn",attrs:{theme:"primary"},on:{click:function(e){return t.toImportNode("construct")}}},[t._v("导入节点")])],1):t._e()]),t._v(" "),n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading.isLoading,title:t.loading.title},expression:"{\n        isLoading: loading.isLoading,\n        title: loading.title\n    }"}],staticClass:"node-container"},[n("section",{staticClass:"sub-view-port"},[t.showContent&&t.nodeList.length?n("bk-table",{staticClass:"node-table-wrapper",attrs:{size:"medium",data:t.nodeList}},[n("bk-table-column",{attrs:{label:"别名",prop:"displayName"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isEnableEdit?n("div",{staticClass:"bk-form-content node-item-content"},[n("div",{staticClass:"edit-content"},[n("input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"},{name:"model",rawName:"v-model",value:t.curEditNodeDisplayName,expression:"curEditNodeDisplayName"}],staticClass:"bk-form-input env-name-input",class:{"is-danger":t.errors.has("nodeName")},attrs:{type:"text",maxlength:"30",name:"nodeName"},domProps:{value:t.curEditNodeDisplayName},on:{input:function(e){e.target.composing||(t.curEditNodeDisplayName=e.target.value)}}}),t._v(" "),n("div",{staticClass:"handler-btn"},[n("span",{staticClass:"edit-base save",on:{click:function(n){return t.saveEdit(e.row)}}},[t._v("保存")]),t._v(" "),n("span",{staticClass:"edit-base cancel",on:{click:function(n){return t.cancelEdit(e.row.nodeHashId)}}},[t._v("取消")])])])]):n("div",{staticClass:"table-node-item node-item-id"},[n("span",{staticClass:"node-name",class:{pointer:t.canShowDetail(e.row)},attrs:{title:e.row.displayName},on:{click:function(n){return t.toNodeDetail(e.row)}}},[t._v(t._s(e.row.displayName||"-"))]),t._v(" "),!t.isEditNodeStatus&&e.row.canEdit?n("i",{staticClass:"bk-icon icon-edit",on:{click:function(n){return t.editNodeName(e.row)}}}):t._e()])]}}],null,!1,3869614813)}),t._v(" "),n("bk-table-column",{attrs:{label:"内网IP",prop:"ip","min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                        "+t._s(e.row.ip||"-")+"\n                    ")]}}],null,!1,1255339529)}),t._v(" "),n("bk-table-column",{attrs:{label:"操作系统",prop:"osName"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                        "+t._s(e.row.osName||"-")+"\n                    ")]}}],null,!1,521931787)}),t._v(" "),n("bk-table-column",{attrs:{label:"来源/导入人",prop:"createdUser","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",[n("span",{staticClass:"node-name"},[t._v(t._s(t.getNodeTypeMap[e.row.nodeType]||"-"))]),t._v(" "),n("span",[t._v("("+t._s(e.row.createdUser)+")")])])]}}],null,!1,3901149093)}),t._v(" "),n("bk-table-column",{attrs:{label:"状态",prop:"nodeStatus"},scopedSlots:t._u([{key:"default",fn:function(e){return["BUILDING_IMAGE"===e.row.nodeStatus&&"DEVCLOUD"===e.row.nodeType?n("div",{staticClass:"table-node-item node-item-status"},[n("span",{staticClass:"node-status-icon normal-stutus-icon"}),t._v(" "),n("span",{staticClass:"node-status"},[t._v("正常")])]):t._e(),t._v(" "),n("div",{staticClass:"table-node-item node-item-status"},[t.successStatus.includes(e.row.nodeStatus)?n("span",{staticClass:"node-status-icon normal-stutus-icon"}):t._e(),t._v(" "),t.failStatus.includes(e.row.nodeStatus)?n("span",{staticClass:"node-status-icon abnormal-stutus-icon"}):t._e(),t._v(" "),t.runningStatus.includes(e.row.nodeStatus)?n("div",{staticClass:"bk-spin-loading bk-spin-loading-mini bk-spin-loading-primary"},[n("div",{staticClass:"rotate rotate1"}),t._v(" "),n("div",{staticClass:"rotate rotate2"}),t._v(" "),n("div",{staticClass:"rotate rotate3"}),t._v(" "),n("div",{staticClass:"rotate rotate4"}),t._v(" "),n("div",{staticClass:"rotate rotate5"}),t._v(" "),n("div",{staticClass:"rotate rotate6"}),t._v(" "),n("div",{staticClass:"rotate rotate7"}),t._v(" "),n("div",{staticClass:"rotate rotate8"})]):t._e(),t._v(" "),"DEVCLOUD"===e.row.nodeType&&"RUNNING"===e.row.nodeStatus?n("span",{staticClass:"install-agent",on:{click:function(n){return t.installAgent(e.row)}}},[t._v("\n                                "+t._s(t.getNodeStatusMap[e.row.nodeStatus])+"\n                            ")]):n("span",{staticClass:"node-status"},[t._v(t._s(t.getNodeStatusMap[e.row.nodeStatus]))])])]}}],null,!1,3554028844)}),t._v(" "),n("bk-table-column",{attrs:{label:"创建/导入时间",prop:"createTime","min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                        "+t._s(e.row.createTime||"-")+"\n                    ")]}}],null,!1,479041889)}),t._v(" "),n("bk-table-column",{attrs:{label:"最后修改时间",prop:"lastModifyTime","min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                        "+t._s(e.row.lastModifyTime||"-")+"\n                    ")]}}],null,!1,1163177375)}),t._v(" "),n("bk-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{staticClass:"table-node-item node-item-handler",class:{"over-handler":t.isMultipleBtn}},[e.row.canDelete&&!["TSTACK","DEVCLOUD"].includes(e.row.nodeType)?n("span",{staticClass:"node-handle delete-node-text",on:{click:function(n){return n.stopPropagation(),t.confirmDelete(e.row,t.index)}}},[t._v("删除")]):t._e(),t._v(" "),e.row.canUse||"CREATING"===e.row.nodeStatus?t._e():n("span",{staticClass:"node-handle delete-node-text",on:{click:function(n){return n.stopPropagation(),t.toNodeApplyPerm(e.row)}}},[t._v("申请权限")])])]}}],null,!1,620002682)})],1):t._e(),t._v(" "),t.showContent&&!t.nodeList.length?n("empty-node",{attrs:{"to-import-node":t.toImportNode,"empty-info":t.emptyInfo}}):t._e()],1)]),t._v(" "),n("third-construct",{attrs:{"construct-tool-conf":t.constructToolConf,"construct-import-form":t.constructImportForm,"connect-node-detail":t.connectNodeDetail,"gateway-list":t.gatewayList,loading:t.dialogLoading,"requet-construct-node":t.requetConstructNode,"has-permission":t.hasPermission,"empty-tips-config":t.emptyTipsConfig,"confirm-fn":t.confirmFn,"cancel-fn":t.cancelFn,"is-agent":t.isAgent,"node-ip":t.nodeIp}})],1)},o=[];s._withStripped=!0,n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return o}))},Te0k:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:{title:{type:String,default:""},desc:{type:String,default:""},btns:{type:Array,default:function(){return[]}}}}},"at9+":function(t,e,n){"use strict";n.r(e);var s=n("MlCl"),o=n("5xk0");for(var a in o)"default"!==a&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("lTz3");var r=n("psIG"),i=Object(r.a)(o.default,s.a,s.b,!1,null,null,null);i.options.__file="src/views/node_list.vue",e.default=i.exports},bcPm:function(t,e,n){"use strict";n.r(e);var s=n("xas+"),o=n("ylmS");for(var a in o)"default"!==a&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("l3eZ");var r=n("psIG"),i=Object(r.a)(o.default,s.a,s.b,!1,null,"b7aa41dc",null);i.options.__file="src/components/devops/environment/third-construct-dialog.vue",e.default=i.exports},"l/j9":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,o=l(n("06Hw")),a=l(n("YYXh")),r=l(n("Kz1y")),i=n("WIBD"),c=l(n("NCmu")),d=l(n("bcPm")),u=n("ygAv");function l(t){return t&&t.__esModule?t:{default:t}}e.default={components:{emptyNode:c.default,thirdConstruct:d.default},data:function(){return{timer:-1,curEditNodeItem:"",curEditNodeDisplayName:"",nodeIp:"",isAgent:!1,isMultipleBtn:!1,isEditNodeStatus:!1,isDropdownShow:!1,showContent:!1,hasPermission:!0,showTooltip:!1,curNodeDialog:"",lastCliCKNode:{},nodeList:[],gatewayList:[],runningStatus:["CREATING","STARTING","STOPPING","RESTARTING","DELETING","BUILDING_IMAGE"],successStatus:["NORMAL","BUILD_IMAGE_SUCCESS"],failStatus:["ABNORMAL","DELETED","LOST","BUILD_IMAGE_FAILED","UNKNOWN","RUNNING"],loading:{isLoading:!1,title:"数据加载中，请稍候"},dialogLoading:{isLoading:!1,title:""},emptyInfo:{title:"导入你的第一个节点",desc:"节点可以是你的开发机，也可以是团队公用的编译机"},constructToolConf:{isShow:!1,hasHeader:!1,quickClose:!1,importText:"导入"},constructImportForm:{model:"MACOS",location:"",link:""},connectNodeDetail:{isConnectNode:!1,hostname:"",status:"UN_IMPORT",os:"macOS 10.13.4"},makeMirrorConf:{isShow:!1},emptyTipsConfig:{title:"没有权限",desc:"你在该项目【节点管理】下没有【创建】权限，请切换项目访问或申请",btns:[{type:"primary",size:"normal",handler:this.changeProject,text:"切换项目"},{type:"success",size:"normal",handler:this.goToApplyPerm,text:"去申请权限"}]}}},computed:(0,r.default)({},(0,i.mapGetters)("environment",["getNodeTypeMap","getNodeStatusMap"]),{projectId:function(){return this.$route.params.projectId},userInfo:function(){return window.userInfo}}),watch:{projectId:(s=(0,a.default)(o.default.mark((function t(e){return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.$router.push({name:"envList"});case 1:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)}),"constructImportForm.model":function(t){t&&!this.isAgent&&this.requestGateway()},"constructImportForm.location":function(t){t&&!this.isAgent&&this.requestDevCommand()}},created:function(){var t=(0,u.getQueryString)("type");t&&(this.constructImportForm.model=t,this.toImportNode("construct"))},mounted:function(){var t=this;return(0,a.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.init();case 2:case"end":return e.stop()}}),e,t)})))()},beforeDestroy:function(){clearTimeout(this.timer),this.timer=null},methods:{init:function(){var t=this;return(0,a.default)(o.default.mark((function e(){var n;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=t.loading).isLoading=!0,n.title="数据加载中，请稍候";try{t.requestList()}catch(e){t.$bkMessage({message:e.message?e.message:e,theme:"error"})}finally{setTimeout((function(){t.loading.isLoading=!1}),1e3)}case 4:case"end":return e.stop()}}),e,t)})))()},requestList:function(){var t=this;return(0,a.default)(o.default.mark((function e(){var n,s;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(t.timer),e.prev=1,e.next=4,t.$store.dispatch("environment/requestNodeList",{projectId:t.projectId});case 4:n=e.sent,t.nodeList.splice(0,t.nodeList.length),n.map((function(e){e.isEnableEdit=e.nodeHashId===t.curEditNodeItem,e.isMore=e.nodeHashId===t.lastCliCKNode.nodeHashId,t.nodeList.push(e)})),t.nodeList.length&&t.loopCheck(),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(1),s=e.t0.message?e.t0.message:e.t0,"error",t.$bkMessage({message:s,theme:"error"});case 15:return e.prev=15,t.showContent=!0,e.finish(15);case 18:case"end":return e.stop()}}),e,t,[[1,10,15,18]])})))()},loopCheck:function(){var t=this;return(0,a.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:clearTimeout(t.timer),t.nodeList.length&&(t.timer=setTimeout((0,a.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.requestList();case 2:case"end":return e.stop()}}),e,t)}))),8e3));case 2:case"end":return e.stop()}}),e,t)})))()},changeProject:function(){this.$toggleProjectMenu(!0)},goToApplyPerm:function(){var t="/backend/api/perm/apply/subsystem/?client_id=node&project_code="+this.projectId+"&service_code=environment&role_creator=env_node";window.open(t,"_blank")},toNodeApplyPerm:function(t){var e="/backend/api/perm/apply/subsystem/?client_id=node&project_code="+this.projectId+"&service_code=environment&role_manager=env_node:"+t.nodeHashId;window.open(e,"_blank")},dropdownIsShow:function(t){this.isDropdownShow="show"===t},toNodeDetail:function(t){this.canShowDetail(t)&&this.$router.push({name:"nodeDetail",params:{nodeHashId:t.nodeHashId}})},toInstall:function(){var t=DOCS_URL_PREFIX+"/%E6%89%80%E6%9C%89%E6%9C%8D%E5%8A%A1/%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/installGseAgentGuide.html";window.open(t,"_blank")},confirmDelete:function(t,e){var n=this;return(0,a.default)(o.default.mark((function e(){var s,r,i,c;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=[],r=t.nodeHashId,s.push(r),i=n.$createElement,c=i("p",{style:{textAlign:"center"}},"确定删除节点("+t.nodeId+")？"),n.$bkInfo({title:"删除",subHeader:c,confirmFn:function(){var t=(0,a.default)(o.default.mark((function t(){var e,a;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=void 0,a=void 0,t.prev=1,t.next=4,n.$store.dispatch("environment/toDeleteNode",{projectId:n.projectId,params:s});case 4:e="删除成功",a="success",t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),e=t.t0.data?t.t0.data.message:t.t0,a="error";case 12:return t.prev=12,n.$bkMessage({message:e,theme:a}),n.requestList(),t.finish(12);case 16:case"end":return t.stop()}}),t,n,[[1,8,12,16]])})));return function(){return t.apply(this,arguments)}}()});case 6:case"end":return e.stop()}}),e,n)})))()},changeCreatedUser:function(t){var e=this;return(0,a.default)(o.default.mark((function n(){var s,r;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:s=e.$createElement,r=s("p",{style:{textAlign:"center"}},"是否修改主机责任人为当前用户？"),e.$bkInfo({title:"修改导入人",subHeader:r,confirmFn:function(){var n=(0,a.default)(o.default.mark((function n(){var s,a,r,i;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=void 0,a=void 0,r={},n.prev=2,n.next=5,e.$store.dispatch("environment/changeCreatedUser",{projectId:e.projectId,nodeHashId:t,params:r});case 5:s="修改成功",a="success",n.next=14;break;case 9:n.prev=9,n.t0=n.catch(2),i=n.t0.message?n.t0.message:n.t0,"error",e.$bkMessage({message:i,theme:"error"});case 14:return n.prev=14,e.$bkMessage({message:s,theme:a}),e.requestList(),n.finish(14);case 18:case"end":return n.stop()}}),n,e,[[2,9,14,18]])})));return function(){return n.apply(this,arguments)}}()});case 3:case"end":return n.stop()}}),n,e)})))()},requetConstructNode:function(){var t=this;return(0,a.default)(o.default.mark((function e(){var n,s;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.dialogLoading.isLoading=!0,e.prev=1,e.next=4,t.$store.dispatch("environment/requetConstructNode",{projectId:t.projectId,agentId:t.constructImportForm.agentId});case 4:n=e.sent,t.connectNodeDetail=(0,r.default)({},n),e.next=13;break;case 8:e.prev=8,e.t0=e.catch(1),s=e.t0.message?e.t0.message:e.t0,"error",t.$bkMessage({message:s,theme:"error"});case 13:return e.prev=13,t.dialogLoading.isLoading=!1,e.finish(13);case 16:case"end":return e.stop()}}),e,t,[[1,8,13,16]])})))()},switchConstruct:function(t){var e=this;return(0,a.default)(o.default.mark((function n(){var s,a,r;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=void 0,a=void 0,e.dialogLoading.isLoading=!0,n.prev=2,n.next=5,e.$store.dispatch("environment/hasConstructPermission",{projectId:e.projectId});case 5:n.sent?(e.constructToolConf.isShow=!0,t?(r="DEVCLOUD"===t.nodeType?"shenzhen":t.gateway,e.constructImportForm.model="DEVCLOUD"===t.nodeType?"LINUX":t.osName.toUpperCase(),e.requestGateway(r,t)):(e.constructImportForm.model="MACOS",e.requestGateway())):(s="第三方构建机接入灰度公测中",a="warning",e.$bkMessage({message:s,theme:a})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(2),s=n.t0.message?n.t0.message:n.t0,a="error",e.$bkMessage({message:s,theme:a});case 14:case"end":return n.stop()}}),n,e,[[2,9]])})))()},requestGateway:function(t,e){var n=this;return(0,a.default)(o.default.mark((function s(){var a,r,i;return o.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,n.$store.dispatch("environment/requestGateway",{projectId:n.projectId,model:n.constructImportForm.model});case 3:a=s.sent,n.gatewayList.splice(0,n.gatewayList.length),n.constructImportForm.location="",a.map((function(t){n.gatewayList.push(t)})),n.gatewayList.length&&t&&"shenzhen"===t?n.constructImportForm.location="shenzhen":n.gatewayList.length&&t&&"shenzhen"!==t?(r=n.gatewayList.find((function(e){return e.showName===t})),n.constructImportForm.location=r&&r.zoneName):n.gatewayList.length&&!t&&(n.constructImportForm.location=n.gatewayList[0].zoneName),e&&"THIRDPARTY"===e.nodeType?n.getVmBuildDetail(e.nodeHashId):n.requestDevCommand(),s.next=16;break;case 11:s.prev=11,s.t0=s.catch(0),i=s.t0.message?s.t0.message:s.t0,"error",403===s.t0.httpStatus?n.hasPermission=!1:n.$bkMessage({message:i,theme:"error"});case 16:case"end":return s.stop()}}),s,n,[[0,11]])})))()},requestDevCommand:function(){var t=this;return(0,a.default)(o.default.mark((function e(){var n,s;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.dialogLoading.isLoading=!0,e.prev=1,e.next=4,t.$store.dispatch("environment/requestDevCommand",{projectId:t.projectId,model:t.constructImportForm.model,zoneName:t.constructImportForm.location||void 0});case 4:n=e.sent,t.constructImportForm.link=n.link,t.constructImportForm.agentId=n.agentId,t.requetConstructNode(),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(1),s=e.t0.message?e.t0.message:e.t0,"error",403===e.t0.httpStatus?t.hasPermission=!1:t.$bkMessage({message:s,theme:"error"});case 15:return e.prev=15,t.dialogLoading.isLoading=!1,e.finish(15);case 18:case"end":return e.stop()}}),e,t,[[1,10,15,18]])})))()},getVmBuildDetail:function(t){var e=this;return(0,a.default)(o.default.mark((function n(){var s,a;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.$store.dispatch("environment/requestNodeDetail",{projectId:e.projectId,nodeHashId:t});case 3:"WINDOWS"===(s=n.sent).os&&s.agentUrl?(e.constructImportForm.link=s.agentUrl,e.constructImportForm.agentId=s.agentId,e.requetConstructNode()):["MACOS","LINUX"].includes(s.os)&&s.agentScript?(e.constructImportForm.link=s.agentScript,e.constructImportForm.agentId=s.agentId,e.requetConstructNode()):e.requestDevCommand(),n.next=12;break;case 7:n.prev=7,n.t0=n.catch(0),a=n.t0.message?n.t0.message:n.t0,"error",e.$bkMessage({message:a,theme:"error"});case 12:case"end":return n.stop()}}),n,e,[[0,7]])})))()},installAgent:function(t){if(["DEVCLOUD","THIRDPARTY"].includes(t.nodeType))this.nodeIp=t.ip,this.isAgent=!0,this.constructToolConf.importText="确定",this.switchConstruct(t);else if(["CC","CMDB"].includes(t.nodeType)){var e=DOCS_URL_PREFIX+"/所有服务/环境管理/installGseAgentGuide.html";window.open(e,"_blank")}},toImportNode:function(t){var e=this;return(0,a.default)(o.default.mark((function t(){return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.switchConstruct();case 1:case"end":return t.stop()}}),t,e)})))()},confirmFn:function(){var t=this;return(0,a.default)(o.default.mark((function e(){var n,s;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.dialogLoading.isLoading){e.next=23;break}return t.dialogLoading.isLoading=!0,t.constructToolConf.importText="确定"===t.constructToolConf.importText?"提交中...":"导入中...",n=void 0,s=void 0,e.prev=4,e.next=7,t.$store.dispatch("environment/importConstructNode",{projectId:t.projectId,agentId:t.constructImportForm.agentId});case 7:n="提交中..."===t.constructToolConf.importText?"提交成功":"导入成功",s="success",t.constructToolConf.isShow=!1,e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),n=e.t0.message?e.t0.message:e.t0,s="error";case 16:return e.prev=16,t.$bkMessage({message:n,theme:s}),t.dialogLoading.isLoading=!1,t.dialogLoading.isShow=!1,t.constructToolConf.importText="导入",t.requestList(),e.finish(16);case 23:case"end":return e.stop()}}),e,t,[[4,12,16,23]])})))()},cancelFn:function(){this.dialogLoading.isShow||(this.isAgent=!1,this.constructToolConf.isShow=!1,this.dialogLoading.isShow=!1,this.constructToolConf.importText="导入")},editNodeName:function(t){this.curEditNodeDisplayName=t.displayName,this.isEditNodeStatus=!0,this.curEditNodeItem=t.nodeHashId,this.nodeList.map((function(e){e.nodeHashId===t.nodeHashId&&(e.isEnableEdit=!0)}))},saveEdit:function(t){var e=this;return(0,a.default)(o.default.mark((function n(){var s,a,r;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.$validator.validate();case 2:if(!n.sent){n.next=21;break}return s=void 0,a=void 0,r={displayName:e.curEditNodeDisplayName.trim()},n.prev=6,n.next=9,e.$store.dispatch("environment/updateDisplayName",{projectId:e.projectId,nodeHashId:t.nodeHashId,params:r});case 9:s="修改成功",a="success",n.next=17;break;case 13:n.prev=13,n.t0=n.catch(6),s=n.t0.message?n.t0.message:n.t0,a="error";case 17:return n.prev=17,e.$bkMessage({message:s,theme:a}),"success"===a&&(e.nodeList.map((function(n){n.nodeHashId===t.nodeHashId&&(n.isEnableEdit=!1,n.displayName=e.curEditNodeDisplayName)})),e.isEditNodeStatus=!1,e.curEditNodeItem="",e.curEditNodeDisplayName="",e.requestList()),n.finish(17);case 21:case"end":return n.stop()}}),n,e,[[6,13,17,21]])})))()},cancelEdit:function(t){this.isEditNodeStatus=!1,this.curEditNodeItem="",this.curEditNodeDisplayName="",this.nodeList.map((function(e){e.nodeHashId===t&&(e.isEnableEdit=!1)}))},destoryNode:function(t){var e=this;return(0,a.default)(o.default.mark((function n(){var s,r;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:s=e.$createElement,r=s("p",{style:{textAlign:"center"}},"确定销毁该节点？"),e.$bkInfo({title:"确定",subHeader:r,confirmFn:function(){var n=(0,a.default)(o.default.mark((function n(){var s,a;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return clearTimeout(e.timer),s=void 0,a=void 0,n.prev=2,n.next=5,e.$store.dispatch("environment/toDestoryNode",{projectId:e.projectId,nodeHashId:t.nodeHashId});case 5:s="提交成功",a="success",n.next=13;break;case 9:n.prev=9,n.t0=n.catch(2),s=n.t0.message?n.t0.message:n.t0,a="error";case 13:return n.prev=13,e.$bkMessage({message:s,theme:a}),e.requestList(),n.finish(13);case 17:case"end":return n.stop()}}),n,e,[[2,9,13,17]])})));return function(){return n.apply(this,arguments)}}()});case 3:case"end":return n.stop()}}),n,e)})))()},canShowDetail:function(t){return"THIRDPARTY"===t.nodeType||"DEVCLOUD"===t.nodeType&&"NORMAL"===t.nodeStatus}}}},l3eZ:function(t,e,n){"use strict";var s=n("qb8q");n.n(s).a},lTz3:function(t,e,n){"use strict";var s=n("K3Q+");n.n(s).a},neEv:function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticClass:"devops-empty-tips"},[n("h2",{staticClass:"title"},[t._v(t._s(t.title))]),t._v(" "),n("p",{staticClass:"desc"},[t._v(t._s(t.desc))]),t._v(" "),n("p",{staticClass:"btns-row"},[t._t("btns",t._l(t.btns,(function(e,s){return n("button",{key:s,staticClass:"bk-button",class:["bk-"+e.type,"bk-button-"+e.size],on:{click:e.handler}},[t._v("\n                "+t._s(e.text)+"\n            ")])})))],2)])},o=[];s._withStripped=!0,n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return o}))},qb8q:function(t,e,n){},wGpf:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,o=n("wm1E"),a=(s=o)&&s.__esModule?s:{default:s},r=n("ygAv");e.default={components:{"empty-tips":a.default},props:{loading:Object,constructToolConf:Object,connectNodeDetail:Object,constructImportForm:Object,emptyTipsConfig:Object,gatewayList:Array,requetConstructNode:Function,confirmFn:Function,cancelFn:Function,hasPermission:Boolean,isAgent:Boolean,nodeIp:String},data:function(){return{defaultMachineCover:n("GXF3"),installDocsLink:DOCS_URL_PREFIX+"/所有服务/环境管理/如何在Windows上安装蓝盾构建机Agent.html"}},methods:{copyCommand:function(){(0,r.copyText)(this.constructImportForm.link)&&this.$bkMessage({theme:"success",message:"复制成功"})}}}},wm1E:function(t,e,n){"use strict";n.r(e);var s=n("neEv"),o=n("80kE");for(var a in o)"default"!==a&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("MkV0");var r=n("psIG"),i=Object(r.a)(o.default,s.a,s.b,!1,null,null,null);i.options.__file="src/components/devops/emptyTips.vue",e.default=i.exports},"xas+":function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("bk-dialog",{attrs:{width:"640","close-icon":!1},model:{value:t.constructToolConf.isShow,callback:function(e){t.$set(t.constructToolConf,"isShow",e)},expression:"constructToolConf.isShow"}},[n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading.isLoading,title:t.loading.title},expression:"{\n            isLoading: loading.isLoading,\n            title: loading.title\n        }"}]},[t.hasPermission?n("div",{staticClass:"bk-form machine-params-form"},[n("div",{staticClass:"bk-form-item is-required"},[n("label",{staticClass:"bk-label env-item-label"},[t._v("机型：")]),t._v(" "),n("div",{staticClass:"bk-form-content",staticStyle:{"margin-top":"4px"}},[n("bk-radio-group",{model:{value:t.constructImportForm.model,callback:function(e){t.$set(t.constructImportForm,"model",e)},expression:"constructImportForm.model"}},[n("bk-radio",{attrs:{value:"MACOS",disabled:t.isAgent}},[t._v("macOS")]),t._v(" "),n("bk-radio",{attrs:{value:"LINUX",disabled:t.isAgent}},[t._v("Linux")]),t._v(" "),n("bk-radio",{attrs:{value:"WINDOWS",disabled:t.isAgent}},[t._v("Windows")])],1)],1)]),t._v(" "),t.gatewayList.length?n("div",{staticClass:"bk-form-item is-required"},[n("label",{staticClass:"bk-label env-item-label"},[n("bk-popover",{attrs:{placement:"right"}},[n("span",{staticStyle:{"padding-bottom":"3px","border-bottom":"dashed 1px #c3cdd7"}},[t._v("地点")]),t._v("：\n                        "),n("template",{slot:"content"},[n("p",{staticStyle:{width:"300px","text-align":"left","white-space":"normal","word-break":"break-all","font-weight":"400"}},[t._v("\n                                请根据构建机的归属地选择最近的接入点，这样可以提高构建机的归档和拉取构建产物的速度，并增加构建机的连接稳定性。PS:北京地区请选择天津。\n                            ")])])],2)],1),t._v(" "),n("div",{staticClass:"bk-form-content",staticStyle:{"margin-top":"4px"}},[n("bk-radio-group",{model:{value:t.constructImportForm.location,callback:function(e){t.$set(t.constructImportForm,"location",e)},expression:"constructImportForm.location"}},t._l(t.gatewayList,(function(e,s){return n("bk-radio",{key:s,attrs:{value:e.zoneName,disabled:t.isAgent}},[t._v(t._s(e.showName))])})),1)],1)]):t._e(),t._v(" "),n("p",{staticClass:"handler-prompt"},[t._v(t._s("WINDOWS"===t.constructImportForm.model?"请参考以下步骤":"在目标构建机任意路径下(工作空间)执行如下命令："))]),t._v(" "),"WINDOWS"!==t.constructImportForm.model?n("div",{staticClass:"construct-card-item command-tool-card"},[n("div",{staticClass:"command-line"},[t._v("\n                    "+t._s(t.constructImportForm.link)+"\n                ")]),t._v(" "),n("div",{staticClass:"copy-button"},[n("a",{staticClass:"text-link copy-command",on:{click:t.copyCommand}},[t._v("\n                        点击复制")])])]):t._e(),t._v(" "),"WINDOWS"===t.constructImportForm.model?n("div",{staticClass:"construct-card-item command-tool-card windows-node-card"},[n("div",{staticClass:"command-line"},[t._v("\n                    1."),n("a",{staticClass:"refresh-detail",attrs:{href:t.constructImportForm.link}},[t._v("点击")]),t._v("下载Agent\n                    "),n("br"),t._v("\n                    2.查阅【"),n("a",{staticClass:"refresh-detail",attrs:{target:"_blank",href:t.installDocsLink}},[t._v("如何在Windows上安装蓝盾构建机Agent")]),t._v("】\n                ")])]):t._e(),t._v(" "),n("p",{staticClass:"handler-prompt"},[t._v("已连接的节点")]),t._v(" "),n("div",{staticClass:"construct-card-item connection-node-card"},["UN_IMPORT"===t.connectNodeDetail.status?n("p",{staticClass:"no-connection-node"},[t._v("\n                    暂未连接任何节点，"),n("span",{staticClass:"refresh-detail",on:{click:t.requetConstructNode}},[t._v("点击刷新")])]):t._e(),t._v(" "),["UN_IMPORT_OK","IMPORT_EXCEPTION"].includes(t.connectNodeDetail.status)?n("div",{staticClass:"connected-node-msg"},[n("div",{staticClass:"node-info"},[n("img",{staticClass:"node-icon",attrs:{src:t.defaultMachineCover}}),t._v(" "),n("div",{staticClass:"node-msg-intro"},[n("p",{staticClass:"node-name"},[t._v(t._s(t.connectNodeDetail.hostname))]),t._v(" "),n("p",[n("span",{staticClass:"agent-status"},[t._v("Agent状态：")]),t._v(" "),n("span",{class:"UN_IMPORT_OK"===t.connectNodeDetail.status?"normal-status-node":"abnormal-status-node"},[t._v("\n                                    "+t._s("UN_IMPORT_OK"===t.connectNodeDetail.status?"正常":"异常")+"\n                                ")]),t._v(" "),n("span",{staticClass:"operating-system"},[t._v("操作系统：")]),t._v(" "),n("span",[t._v(t._s(t.connectNodeDetail.os))])])])])]):t._e()]),t._v(" "),t.isAgent?n("p",{staticClass:"target-console-tips"},[t._v("目标机登录方式：ssh -p36000 root@"+t._s(t.nodeIp)+" 密码请查收邮件！")]):t._e()]):t._e(),t._v(" "),t.hasPermission?t._e():n("empty-tips",{attrs:{title:t.emptyTipsConfig.title,desc:t.emptyTipsConfig.desc,btns:t.emptyTipsConfig.btns}})],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("div",{staticClass:"footer-handler"},[n("bk-button",{attrs:{theme:"primary",disabled:"UN_IMPORT"===t.connectNodeDetail.status},on:{click:t.confirmFn}},[t._v(t._s(t.constructToolConf.importText))]),t._v(" "),n("bk-button",{attrs:{theme:"default"},on:{click:t.cancelFn}},[t._v("取消")])],1)])])},o=[];s._withStripped=!0,n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return o}))},ylmS:function(t,e,n){"use strict";n.r(e);var s=n("wGpf"),o=n.n(s);for(var a in s)"default"!==a&&function(t){n.d(e,t,(function(){return s[t]}))}(a);e.default=o.a}}]);